(function(){angular.module("mapaAssedioApp",["ngRoute","ngTagsInput","ngAnimate","ngTouch","ui.bootstrap","duScroll"]);function o(o){o.when("/",{templateUrl:"views/index.html",controller:"indexCtrl",controllerAs:"index"}).otherwise({redirectTo:"/"})}angular.module("mapaAssedioApp").config(["$routeProvider",o])})();(function(){angular.module("mapaAssedioApp").controller("indexCtrl",t);function o(o,e){o.$on("$routeChangeStart",e)}function e(o,e,n){o.$on(e,function(o,e){n(e)})}function n(o,e,n){return function(t){var r={};if(t){r=t}var a=o.open({animation:true,templateUrl:e,controller:n,controllerAs:"vm",size:"lg",resolve:r});a.result.then(function(o){console.log("fechando")},function(){console.log("Modal dismissed at: "+new Date)})}}t.$inject=["$rootScope","$scope","reportsService","usersService","$uibModal","$log","authService","$location","$anchorScroll"];function t(t,a,s,i,l,c,u,g,p){var d=this;d.loggedUser;d.isLoggedIn;var f=function(){d.loggedUser=u.getLoggedUser();d.isLoggedIn=u.isLoggedIn()};f();e(a,"SUCCESS_LOGIN",f);e(a,"login",function(){d.openLoginModal()});e(a,"register",function(){d.openRegisterModal()});o(t,function(){f()});d.openRegisterModal=n(l,"/views/userModal/userRegister.html","userRegisterCtrl");d.openLoginModal=n(l,"/views/userModal/login.html","loginCtrl");d.openReportModal=n(l,"/views/reportModal/reportModal.html","reportModalCtrl");d.openAuthModal=n(l,"views/userModal/authUser.html","authUserCtrl");d.logout=function(){u.logout();g.path("/");f()};r(d,a)}function r(o,e){o.harassmentMap=new HarassmentMap;var n=o.harassmentMap.createMap("map");var t=o.harassmentMap.createInfoWindow();o.harassmentMap.goToUserLocation(function(o){t.setPosition(o);t.setContent("Localização encontrada!")},function(){t.setPosition(n.getCenter());t.setContent("A localização falhou!")});o.harassmentMap.setClickEvent(function(n,t){e.$apply(function(){var e={lat:n.latLng.lat(),lng:n.latLng.lng()};if(o.isLoggedIn){o.openReportModal({pos:e})}else{o.openAuthModal()}})})}})();(function(){angular.module("mapaAssedioApp").controller("reportModalCtrl",o);o.$inject=["$scope","$uibModalInstance","pos","reportsService"];function o(o,n,t,r){var a=this;a.tags=[];a.denuncia={pos:t,tags:[],victim:false,crime:"",anonymous:false,user:null,date:null};a.ok=function(){a.denuncia.tags=e(a.tags);console.log(a.denuncia);r.newReport(a.denuncia).success(function(o){console.log("sucesso ao cadastrar denuncia");console.log(o)}).error(function(o){console.log("erro ao cadastrar denuncia");console.log(o)})};a.cancel=function(){n.dismiss("cancel")}}function e(o){var e;var n=[];for(e=0;e<o.length;e++){n.push(o[e].text)}return n}})();(function(){angular.module("mapaAssedioApp").controller("userRegisterCtrl",o);o.$inject=["$scope","$uibModalInstance","authService"];function o(o,e,n){var t=this;t.password="";t.user={name:"",birthDate:(new Date).now,email:"",sex:""};t.ok=function(){console.log("cadastrando");console.log(t.user);console.log(t.password);n.register({user:t.user,password:t.password}).success(function(){console.log("cadastrou com sucesso")});e.close("modal close method")};t.cancel=function(){console.log("cancelar");t.user={name:"",birthDate:{},email:"",sex:""};t.password="";e.dismiss("cancel")}}})();(function(){angular.module("mapaAssedioApp").controller("loginCtrl",o);o.$inject=["$rootScope","$scope","$uibModalInstance","authService"];function o(o,e,n,t){var r=this;r.user={email:"",password:""};r.ok=function(){t.login(r.user).success(function(e){console.log("sucesso ao logar");o.$broadcast("SUCCESS_LOGIN",e);n.close("modal close method")}).error(function(o){console.log("erro ao logar");console.log(o)})};r.cancel=function(){n.dismiss("cancel");r.user={email:"",password:""}}}})();(function(){angular.module("mapaAssedioApp").controller("authUserCtrl",o);o.$inject=["$scope","$uibModalInstance","$rootScope"];function o(o,e,n){var t=this;t.login=function(){console.log("logar");e.close("modal close method");n.$broadcast("login");angular.element("body").css("padding-right","0px")};t.register=function(){console.log("regiter");e.close("modal close method");n.$broadcast("register");angular.element("body").css("padding-right","0px")}}})();(function(){angular.module("mapaAssedioApp").service("authService",o);o.$inject=["$window","$http"];function o(o,e){var n=function(e){return JSON.parse(o.atob(e.split(".")[1]))};var t=function(e){o.localStorage["harassment-map"]=e};var r=function(){return o.localStorage["harassment-map"]};var a=function(){o.localStorage.removeItem("harassment-map")};var s=function(o){return e.post("/api/login",o).success(function(o){t(o.token)})};var i=function(o){return e.post("/api/register",o).success(function(o){t(o.token)})};var l=function(){var o=r();var e;if(o){e=n(o);return e.exp>Date.now()/1e3}else{return false}};var c=function(){if(l()){return n(r())}};return{saveToken:t,getToken:r,logout:a,login:s,register:i,isLoggedIn:l,getLoggedUser:c}}})();(function(){angular.module("mapaAssedioApp").service("reportsService",o);o.$inject=["$http"];function o(o){return{getReports:function(e,n,t){return o.get("/api/reports/lat/"+e+"/lng/"+n+"/distance/"+t)},newReport:function(e){return o.post("/api/reports",e)}}}})();(function(){angular.module("mapaAssedioApp").service("usersService",o);o.$inject=["$http"];function o(o){return{newUser:function(e){return o.post("/api/users",e)}}}})();