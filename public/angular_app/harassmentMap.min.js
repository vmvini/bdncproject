(function(){angular.module("mapaAssedioApp",["ngRoute","ngTagsInput","ngAnimate","ngTouch","ui.bootstrap"]);function e(e){e.when("/",{templateUrl:"views/index.html",controller:"indexCtrl",controllerAs:"index"}).otherwise({redirectTo:"/"})}angular.module("mapaAssedioApp").config(["$routeProvider",e])})();(function(){angular.module("mapaAssedioApp").controller("indexCtrl",o);function e(e,o){e.$on("$routeChangeStart",o)}o.$inject=["$rootScope","$scope","reportsService","usersService","$uibModal","$log","authService","$location"];function o(o,n,t,r,a,s,i,l){var c=this;c.loggedUser;c.isLoggedIn;var u=function(e){c.loggedUser=i.getLoggedUser();c.isLoggedIn=i.isLoggedIn()};u();e(o,function(){u()});n.$on("SUCCESS_LOGIN",function(e,o){u()});c.logout=function(){i.logout();l.path("/");u()};c.openRegisterModal=function(){var e=a.open({animation:true,templateUrl:"/views/userModal/userRegister.html",controller:"userRegisterCtrl",controllerAs:"vm",size:"lg",resolve:{}});e.result.then(function(e){console.log("fechando: "+e)},function(){s.info("Modal dismissed at: "+new Date)})};c.openLoginModal=function(){var e=a.open({animation:true,templateUrl:"/views/userModal/login.html",controller:"loginCtrl",controllerAs:"vm",size:"lg",resolve:{}});e.result.then(function(e){console.log("fechando: "+e)},function(){s.info("Modal dismissed at: "+new Date)})};c.openReportModal=function(e,o){var n=a.open({animation:true,templateUrl:"/views/reportModal/reportModal.html",controller:"reportModalCtrl",controllerAs:"vm",size:e,resolve:{pos:o}});n.result.then(function(e){console.log("fechando: "+e)},function(){s.info("Modal dismissed at: "+new Date)})};p();function p(){c.harassmentMap=new HarassmentMap;var e=c.harassmentMap.createMap("map");var o=c.harassmentMap.createInfoWindow();c.harassmentMap.goToUserLocation(function(e){o.setPosition(e);o.setContent("Localização encontrada!")},function(){o.setPosition(e.getCenter());o.setContent("A localização falhou!")});c.harassmentMap.setClickEvent(function(e,o){n.$apply(function(){var o={lat:e.latLng.lat(),lng:e.latLng.lng()};c.openReportModal("lg",o)})})}}})();(function(){angular.module("mapaAssedioApp").controller("reportModalCtrl",e);e.$inject=["$scope","$uibModalInstance","pos"];function e(e,o,n){var t=this;t.denuncia={pos:n,tags:[],victim:false,crime:"",anonymous:false,user:{},date:{}};t.ok=function(){console.log(t.denuncia);o.close("modal close method")};t.cancel=function(){o.dismiss("cancel")}}})();(function(){angular.module("mapaAssedioApp").controller("userRegisterCtrl",e);e.$inject=["$scope","$uibModalInstance","authService"];function e(e,o,n){var t=this;t.password="";t.user={name:"",birthDate:(new Date).now,email:"",sex:""};t.ok=function(){console.log("cadastrando");console.log(t.user);console.log(t.password);n.register({user:t.user,password:t.password}).success(function(){console.log("cadastrou com sucesso")});o.close("modal close method")};t.cancel=function(){console.log("cancelar");t.user={name:"",birthDate:{},email:"",sex:""};t.password="";o.dismiss("cancel")}}})();(function(){angular.module("mapaAssedioApp").controller("loginCtrl",e);e.$inject=["$rootScope","$scope","$uibModalInstance","authService"];function e(e,o,n,t){var r=this;r.user={email:"",password:""};r.ok=function(){t.login(r.user).success(function(o){console.log("sucesso ao logar");e.$broadcast("SUCCESS_LOGIN",o);n.close("modal close method")}).error(function(e){console.log("erro ao logar");console.log(e)})};r.cancel=function(){n.dismiss("cancel");r.user={email:"",password:""}}}})();(function(){angular.module("mapaAssedioApp").service("authService",e);e.$inject=["$window","$http"];function e(e,o){var n=function(o){return JSON.parse(e.atob(o.split(".")[1]))};var t=function(o){e.localStorage["harassment-map"]=o};var r=function(){return e.localStorage["harassment-map"]};var a=function(){e.localStorage.removeItem("harassment-map")};var s=function(e){return o.post("/api/login",e).success(function(e){t(e.token)})};var i=function(e){return o.post("/api/register",e).success(function(e){t(e.token)})};var l=function(){var e=r();var o;if(e){o=n(e);return o.exp>Date.now()/1e3}else{return false}};var c=function(){if(l()){return n(r())}};return{saveToken:t,getToken:r,logout:a,login:s,register:i,isLoggedIn:l,getLoggedUser:c}}})();(function(){angular.module("mapaAssedioApp").service("reportsService",e);e.$inject=["$http"];function e(e){return{getReports:function(o,n,t){return e.get("/api/reports/lat/"+o+"/lng/"+n+"/distance/"+t)},newReport:function(o){return e.post("/api/reports",o)}}}})();(function(){angular.module("mapaAssedioApp").service("usersService",e);e.$inject=["$http"];function e(e){return{newUser:function(o){return e.post("/api/users",o)}}}})();