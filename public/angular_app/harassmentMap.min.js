(function(){angular.module("mapaAssedioApp",["ngRoute","ngTagsInput","ngAnimate","ngTouch","ui.bootstrap"]);function e(e){e.when("/",{templateUrl:"views/index.html",controller:"indexCtrl",controllerAs:"index"}).otherwise({redirectTo:"/"})}angular.module("mapaAssedioApp").config(["$routeProvider",e])})();(function(){angular.module("mapaAssedioApp").controller("indexCtrl",e);e.$inject=["$scope","reportsService","usersService","$uibModal","$log","authService","$location"];function e(e,n,o,t,a,r,i){var s=this;s.loggedUser=r.getLoggedUser();s.isLoggedIn=r.isLoggedIn();s.logout=function(){r.logout();i.path("/")};s.openReportModal=function(e,n){var o=t.open({animation:true,templateUrl:"/views/reportModal/reportModal.html",controller:"reportModalCtrl",controllerAs:"reportModal",size:e,resolve:{pos:n}});o.result.then(function(e){console.log("fechando: "+e)},function(){a.info("Modal dismissed at: "+new Date)})};c();function c(){s.harassmentMap=new HarassmentMap;var n=s.harassmentMap.createMap("map");var o=s.harassmentMap.createInfoWindow();s.harassmentMap.goToUserLocation(function(e){o.setPosition(e);o.setContent("Localização encontrada!")},function(){o.setPosition(n.getCenter());o.setContent("A localização falhou!")});s.harassmentMap.setClickEvent(function(n,o){e.$apply(function(){var e={lat:n.latLng.lat(),lng:n.latLng.lng()};s.openReportModal("lg",e)})})}}})();(function(){angular.module("mapaAssedioApp").controller("reportModalCtrl",e);e.$inject=["$scope","$uibModalInstance","pos"];function e(e,n,o){var t=this;t.denuncia={pos:o,tags:[],victim:false,crime:"",anonymous:false,user:{},date:{}};t.ok=function(){console.log(t.denuncia);n.close("modal close method")};t.cancel=function(){n.dismiss("cancel")}}})();(function(){angular.module("mapaAssedioApp").service("authService",e);e.$inject=["$window"];function e(e){var n=function(n){return JSON.parse(e.atob(n.split(".")[1]))};var o=function(n){e.localStorage["harassment-map"]=n};var t=function(){return e.localStorage["harassment-map"]};var a=function(){e.localStorage.removeItem("harassment-map")};var r=function(e){return $http.post("/api/login",e).success(function(e){o(e.token)})};var i=function(e){return $http.post("/api/register",e).success(function(e){o(e.token)})};var s=function(){var e=t();var o;if(e){o=n(e);return o.exp>Date.now()/1e3}else{return false}};var c=function(){if(s()){return n(t())}};return{saveToken:o,getToken:t,logout:a,login:r,register:i,isLoggedIn:s,getLoggedUser:c}}})();(function(){angular.module("mapaAssedioApp").service("reportsService",e);e.$inject=["$http"];function e(e){return{getReports:function(n,o,t){return e.get("/api/reports/lat/"+n+"/lng/"+o+"/distance/"+t)},newReport:function(n){return e.post("/api/reports",n)}}}})();(function(){angular.module("mapaAssedioApp").service("usersService",e);e.$inject=["$http"];function e(e){return{newUser:function(n){return e.post("/api/users",n)}}}})();